---
title: '6: Capabilites'
layout: posts
---

**Kapabiliteetit** ovat ikään kuin toisenlainen tapa ajatella käyttöoikeuksia. Pohjimmiltaan kapabiliteetti tarkoittaa, että kun prosessi omistaa kapabiliteetin, joka osoittaa johonkin toiseen objektiin, niin tämä prosessi voi käyttää kyseistä objektia rajoitteiden mukaisesti. Esimerkiksi UNIX-systeemien tiedostodeskriptorit ovat ikään kuin kapabiliteetteja. Ääritapauksessa koko systeemi toimisi kapabiliteettien varassa, mutta tämä ei käytännössä ole järkevää, sillä silloin jonkin objektin tietoja ei voisi ikinä käsitellä ilman, että käsittelijällä olisi kapabiliteetti objektiin.
 
**‘*Confused deputy*’ -ongelmalla** tarkoitetaan sitä, että jotakin sovelluksen auktoriteettiprosessia huijataan käyttämään sen oikeuksia väärin. Esimerkkinä Fortran kääntäjä, jonka pystyi ikään kuin huijaamaan kirjoittamaan rajoitettuihin tiedostoihin, sillä sen käyttämiä oikeuksia ei tarvinnut määrätä, se vain käytti kaikkia omistamiaan oikeuksia aina. Tämän esimerkin tapauksessa useampikin asia meni väärin: Niin kutsuttujen ympäröivien auktoriteettien vuoksi lopulliseen toimintoon ei päädytä käyttäjän vuoksi, vaan joidenkin lisäparametrien kautta. Lisäksi kääntäjän yhteydessä oli käytössä tarpeettoman monimutkainen tapa tarkistaa käyttöoikeudet. Vaihtoehtoisesti olisi voitu käyttää vaikkapa UNIX-tyyppisiä tiedostodeskriptoreja tai muita kapabiliteetteja.
 
Sandboxauksella viitataan sovelluksen jakamista sen komponentteihin ja sitten näiden komponenttien oikeuksien rajoittamista niille sopivalla tavalla. Esimerkiksi verkkoselaimessa on järkevää sandboxata *pluginit*, jotta ne eivät voisi vahigoittaa järjestelmää. UNIX-järjestelmissä sandboxaus on perinteisesti ollut hankalaa. Nopeasti voisi ajatella, että tämä onnistuisi uid:n kautta, mutta joitakin tiedostoja on mahdollista lukea tai niihin voidaan kirjoittaa riippumatta prosessin uid-arvosta. Yksi keino sandboxaukselle on ajaa ohjelma virtuaalikoneessa. Tämä lähestymistapa on kuitenkin liian raskas ja sandboxattu osa on liian erossa muista osista. 
 
Capsicum pyrkii ratkaisemaan UNIX-systeemien sandboxausongelman kapabiliteetteihin perustuvalla sandbox-moodilla. Se laajentaa UNIXin toiminnallisuutta, keskittyen erityisesti tiedostodeskriptoreihin. UNIXin globaalit nimiavaruudet, esimerkiksi tiedostosysteemi, ovat ongelmallisia, sillä ne mahdollistavat mm. pääsyn käsiksi melkein mihin vain tiedostoon tiedostopolun avulla. Capsicum pyrkii hankkiutumaan näistä eroon varmistamalla, että jokainen operaation täytyy mennä jonkin kapabiliteetin läpi. *Cap_enter* -komennolla voidaan siirtyä eräänlaiseen kapabiliteettitilaan, jolloin UNIX-kernel alkaa hylkäämään kaikki globaaleihin nimiavaruuksiin viittaavat komennot.  Tämä tila periytyy kaikille lapsiprosesseille, jotta uusi prosessi ei voisi ohittaa sandboxauksen antamaa suojausta. 
 
*Cap_enterin* sijasta kannattaa mahdollisuuksien mukaan käyttää *lch_start* -komentoa, joka käytännössä luo täysin uuden prosessin heti sandboxatussa tilassa. Näin voidaan huomioida kaikki tekijät, jotka voivat vaikuttaa sandboxauksen onnistumiseen, sillä *cap_enterin* kohdalla kapabiliteettimoodiin siirretyllä prosessilla saattaa esimerkiksi jo ennestään olla oikeuksia joihinkin objekteihin. On myös mahdollista hyödyntää ns. tiedostodeskriptori-listoja, joilla siistitään UNIXin tiedostodeskriptoreihin liittyvää viittauskäytäntöä. Näiden avulla tiedostodeskriptorit voidaan nimetä paremmin sen sijasta, että käytettäisiin vain pelkkiä kokonaislukuja. Tämä on usein tarpeen, sillä sandbox-tilassa kapabiliteettien vuoksi hyödynnetään paljon enemmän tiedostodeskriptoreja kuin normaalisti. 
 
Capsicum-systeemiin liittyy myös joitakin turvallisuusriskejä. On esimerkiksi mahdollista, että jollakin sandboxissa olevalla prosessilla on liikaa oikeuksia, eikä käyttäjä voi mitenkään tietää tästä. Huomattavaa osaa koko järjestelmää ei ole mahdollista sandboxata, mikä on selkeä aukko suojauksessa. 
	
 
### Ajatuksia materiaalista
 
Vähän luennon alussa epäilytti, kun siinä käsiteltiin yksityiskohtaisesti jonkin yli 25-vuotta vanhan Fortran-kääntäjän turvallisuusongelmia ‘*confused deputy*’ -ongelmaan liittyen. Vastaava ongelma vaikuttaisi pikaisen googlettelun perusteella kuitenkin edelleen olevan olemassa.
 
En muiden kiireiden vuoksi ehtinyt tähän luentoon käyttämään aivan yhtä paljon aikaa kuin aikaisempien luentojen kohdalla. Tästä syystä monet asiat jäivät vähän epäselviksi, kun en juurikaan pysähdellyt niitä googlettelemaan. Yritin kuitenkin huomioida kaikki kokonaiskuvan kannalta oleellisimmilta vaikuttavat asiat. Uskon ymmärtäväni, mitä Capsicumilla halutaan ratkaista, ja miten tämä ratkaisu toimii. Ei tästäkään kuitenkaan hirveämmin löytynyt muita kuin tieteellisiä artikkeleita. Ei taida siis olla kovin laajassa käytössä. Tulipahan kuitenkin bonuksena opittua, että capsicum tarkoittaa paprikaa…