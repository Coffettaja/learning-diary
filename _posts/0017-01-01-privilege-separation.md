---
title: '4: Privilege Separation'
layout: posts
---

Käyttöoikeuksien erottelulla viitataan ideaan jakaa ohjelmisto osiin siten, että jokaisella osalla on vain sen tarvitsemat käyttöoikeudet. Näin vain pieni osa sovelluksesta vaarantuu mahdollisen hyväksikäytettävän bugin seurauksena. Tämä erottelu voidaan tehdä esimerkiksi virtuaalikoneiden avulla tai vaihtoehtoisesti hyödyntäen UNIX-järjestelmien toimintatapaa.
 
UNIX-järjestelmissä jokaisella prosessilla on yksi käyttäjä id (uid) ja mahdollisesti useita ryhmä-id (gid) -arvoja. Nämä id:t ovat 32-bittisiä kokonaislukuja. Prosessien käyttöoikeudet määräytyvät näiden id:iden perusteella riippuen siitä, mitä kohdetta prosessi yrittää käsitellä. Prosessi, jonka uid on nolla, on *superuser* ja voi tehdä melkein mitä vain. Sen lisäksi esimerkiksi yksittäisten tiedostojen tapauksessa jokin prosessi saattaa haluta kirjoittaa, lukea tai ajaa tiedostoa. Kirjoitus- ja lukuoikeudet määräytyvät gid:n perusteella, kun taas ajo ja myös tiedoston käyttöoikeusbittien (rwx) muuttamisoikeus määräytyy uid:n perusteella: tiedoston ja prosessin uid täytyy olla sama, jolloin kyseinen prosessi omistaa kyseisen tiedoston. Kansioiden tapauksessa toimintaperiaate on pitkälti samanlainen kuin tiedostojen kohdalla.
 
**Tiedostodeskriptori** (engl. *file descriptor*) on kokonaisluku-id, joka yksikäsitteisesti merkitsee käyttöjärjestelmässä avoinna olevia tiedostoja. Deskriptorien tapauksessa käyttöoikeudet tarkistetaan vain tiedostoa avatessa, joten mikäli prosessi on saanut jostain desktriptorin, se voi hyödyntää sitä. Näin prosesseille voidaan antaa käyttöoikeudet vain tiettyihin tiedostoihin.
 
Tietoverkkojen käyttöoikeuksien hallinta poikkeaa merkittävästi muista, sillä ne tulivat osaksi UNIX-järjestelmiä vasta myöhemmin. Esimerkiksi uid-arvo ei vaikuta näihin oikeuksiin. Sen sijaan esimerkiksi portti voi vaikuttaa: useimmat prosessit eivät voi kuunnella portteja, joiden arvo on alle 1024. Näin satunnaiset käyttäjät eivät voi imitoida alhaisten porttiarvojen tunnettuja palveluita. 
 
Eräs käyttöoikeuksien erottelussa hyödynnettävä operaatio on *chroot*, jolla voidaan määrätä jonkin prosessin juuri tiedostopuussa. Tämä tapahtuu siten, että valitusta kansiosta tulee ‘/’ ja tässä kansiossa ollessaan ‘..’ osoittaa takaisin kansioon itseensä. Vain *superuser* voi kutsua *chroottia*, mikä vähentää mahdollisuuksia hyväksikäytölle. 
 
Perinteisesti web palvelimien tapauksessa käyttöoikeuksien erottelua ei ole juurikaan hyödynnetty. Kuitenkin esimerkiksi OKWS (*OK Web Server*) perustuu käyttöoikeuksien erottelulle turvallisuuden parantamiseksi. OKWS:n toimintaperiaate on seuraava: Palvelin koostuu kahdesta laitteesta, ns. *front-end* -laitteesta ja tietokantalaitteesta. Asiakkaan pyynnöt tulevat *front-end* laitteen toimittaja-prosessille, joka kommunikoi kirjaaja-, mallinne- ja palvelinprosessien kanssa. Jokainen näistä prosesseista on *chrootattu* omaan kansioonsa. Lisäksi on olemassa myös *superuser*-prosessi, joka käynnistää muut laitteen prosessit. Tietokantalaitteessa toimii itse tietokannan lisäksi myös tietokantaedustaja-prosessi, joka kommunikoi *front-end* -laitteen palvelinprosessin kanssa. 
 
### Ajatuksia materiaalista
 
Oli varsin virkistävää kolmen puskuriylivuotoihin keskittyneen luennon jälkeen päästä muihin asioihin. Lisäksi tämän luento oli suhteellisen helposti ymmärrettävissä, mikä myöskin oli virkistävä muutos aikaisempiin luentoihin verrattuna. Kokeilin tällä kertaa myös hieman erilaista lähestymistapaa luennon artikkelin kanssa, eli katsoin itse luennon ensin ennen kuin luin / silmäilin artikkelin läpi. Tämä tuntuikin mielekkäämmältä, sillä luennoilla monesti esitetään asioita, joita pitäisi tuntea, että artikkelista saisi mitään irti. 
 
Niin artikkeli kuin luennon jälkipuoliskokin keskittyi hyvin pitkälti vain yksittäiseen systeemiin, eli OKWS:n toimintaperiaatteeseen. Tämä on mielestäni hieman ärsyttävää luennoilla, sillä niissä mennään usein tarpeettoman syvälle yksityiskohtiin, varsinkin kun otetaan huomioon, että niin tämän luennon OKWS kuin myös esimerkiksi aikaisempien luentojen *baggy bounds* -systeemi eivät vaikuta olevan käytössä juuri missään. Pikaisen googletuksen jälkeen vaikuttaisi, että OKWS on sentään käytössä OkCupid-palvelulla vielä tänäkin päivänä, joten OKWS:n yksityiskohtien tietäminen taitaa tulla tarpeeseen vain, mikäli joku joskus aikoo OkCupidille töihin. Muissa tapauksissa luultavampaa on, että käytössä on esimerkiksi Apache, jolloin ei ole oleellista tietää, mikä OKWS:n kunkin prosessin nimi on tai miten ne on kooditasolla toteutettu. Tietysti yleisluontoinen ymmärrys järjestelmästä on OK.
